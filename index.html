<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…Ù†ØµØ© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØªØ¨</title>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Montserrat:wght@600&family=Roboto&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f9f9f9; --card:#fff; --text:#222; --muted:#6b6b6b; --accent:#2b7cff;
      --radius:10px; --shadow:0 6px 18px rgba(0,0,0,0.06); --reader-font-size:18px;
    }
    [data-theme="dark"]{ --bg:#0f1113; --card:#161718; --text:#eaeaea; --muted:#bdbdbd; --accent:#4da3ff; --shadow:0 6px 18px rgba(0,0,0,0.45); }

    *{box-sizing:border-box}
    body{margin:0;font-family:'Roboto',sans-serif;background:var(--bg);color:var(--text);line-height:1.5}
    header{background:var(--card);padding:12px 18px;display:flex;align-items:center;justify-content:space-between;gap:12px;border-bottom:1px solid rgba(0,0,0,0.04);position:sticky;top:0;z-index:10}
    header h1{margin:0;font-family:'Montserrat',sans-serif;color:var(--accent);font-size:20px;display:flex;align-items:center;gap:8px}
    nav{display:flex;align-items:center;gap:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;border:0;cursor:pointer;padding:8px 12px;border-radius:8px;background:var(--accent);color:#fff;font-weight:600}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(0,0,0,0.06)}
    .hero{text-align:center;padding:36px 18px}
    .hero h2{margin:0 0 12px 0;font-family:'Merriweather',serif;font-size:26px}
    .controls{max-width:1200px;margin:0 auto;padding:12px 18px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .search{flex:1;min-width:180px;display:flex;gap:8px;align-items:center}
    .search input{flex:1;padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)}
    .cards{padding:18px;display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));max-width:1200px;margin:0 auto}
    .card{background:var(--card);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;transition:transform .15s;position:relative}
    .card:hover{transform:translateY(-6px)}
    .card img{width:100%;height:150px;object-fit:cover;display:block}
    .card .body{padding:12px}
    .card h3{margin:0 0 6px 0;font-family:'Merriweather',serif;font-size:16px}
    .card p{margin:0;color:var(--muted);font-size:14px}
    .card .actions{display:flex;gap:8px;margin-top:10px}
    .icon-btn{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:6px 8px;border-radius:8px;cursor:pointer}
    .badge{position:absolute;left:10px;top:10px;background:rgba(0,0,0,0.6);color:#fff;padding:6px 8px;border-radius:8px;font-size:13px}

    /* Modal form */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:50;padding:20px}
    .modal.open{display:flex}
    .modal-card{width:100%;max-width:720px;background:var(--card);border-radius:12px;padding:18px;box-shadow:var(--shadow);overflow:auto;max-height:90vh}
    .form-row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
    .form-row input[type="text"], .form-row input[type="url"], .form-row textarea, .form-row select{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)}
    textarea{min-height:100px;resize:vertical}
    .form-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

    footer{text-align:center;padding:18px 12px;color:var(--muted);margin-top:30px}

    @media (max-width:700px){ .hero h2{font-size:20px} .card img{height:140px} }
  </style>
</head>
<body>

  <header>
    <h1>ğŸ“š Ù…Ù†ØµØªÙŠ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©</h1>
    <nav>
      <a class="btn ghost" id="openAdd">Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨</a>
      <button id="themeToggle" class="btn ghost" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">ğŸŒ™</button>
    </nav>
  </header>

  <section class="hero">
    <h2>Ù…ÙƒØªØ¨ØªÙƒ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h2>
    <p style="color:var(--muted);margin-top:8px">Ø£Ø¶Ù ÙƒØªØ¨Ùƒ Ø¨Ø³Ø±Ø¹Ø©ØŒ Ø¹Ø¯Ù‘Ù„Ù‡Ø§ØŒ ÙˆØ§Ø­ÙØ¸Ù‡Ø§ Ù…Ø­Ù„ÙŠØ§Ù‹.</p>
  </section>

  <div class="controls" role="region" aria-label="Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ÙƒØªØ¨Ø©">
    <div class="search">
      <input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ù…Ø¤Ù„Ù..." aria-label="Ø¨Ø­Ø« Ø§Ù„ÙƒØªØ¨">
      <button id="clearSearch" class="btn ghost">Ù…Ø³Ø­</button>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <span style="color:var(--muted);font-size:14px">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØªØ¨: <strong id="count">0</strong></span>
    </div>
  </div>

  <section class="cards" id="cardsContainer" aria-live="polite" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØªØ¨">
    <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ØªÙÙ…Ù„Ø£ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
  </section>

  <!-- Modal Ù„Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨ -->
  <div class="modal" id="modal">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>

      <div class="form-row">
        <input id="title" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨" required>
        <input id="author" type="text" placeholder="Ø§Ù„Ù…Ø¤Ù„Ù" required>
      </div>

      <div class="form-row">
        <input id="category" type="text" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <input id="coverUrl" type="url" placeholder="Ø±Ø§Ø¨Ø· ØºÙ„Ø§Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
      </div>

      <div class="form-row">
        <input id="coverFile" type="file" accept="image/*">
        <div style="min-width:120px">
          <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØºÙ„Ø§Ù</div>
          <img id="coverPreview" src="https://via.placeholder.com/300x150?text=Cover" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØºÙ„Ø§Ù" style="width:120px;height:80px;object-fit:cover;border-radius:6px;border:1px solid rgba(0,0,0,0.06)">
        </div>
      </div>

      <div class="form-row">
        <textarea id="description" placeholder="ÙˆØµÙ Ø§Ù„ÙƒØªØ§Ø¨ Ø£Ùˆ Ù†Ø¨Ø°Ø©"></textarea>
      </div>

      <div class="form-actions">
        <button id="saveBook" class="btn">Ø­ÙØ¸</button>
        <button id="cancel" class="btn ghost">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <footer>Â© 2025 Ù…Ù†ØµØªÙŠ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</footer>

  <script>
    // Ø¹Ù†Ø§ØµØ± DOM
    const modal = document.getElementById('modal');
    const openAdd = document.getElementById('openAdd');
    const cancel = document.getElementById('cancel');
    const saveBook = document.getElementById('saveBook');
    const cardsContainer = document.getElementById('cardsContainer');
    const coverFile = document.getElementById('coverFile');
    const coverPreview = document.getElementById('coverPreview');
    const coverUrl = document.getElementById('coverUrl');
    const titleInput = document.getElementById('title');
    const authorInput = document.getElementById('author');
    const categoryInput = document.getElementById('category');
    const descriptionInput = document.getElementById('description');
    const searchInput = document.getElementById('searchInput');
    const clearSearch = document.getElementById('clearSearch');
    const countEl = document.getElementById('count');
    const themeToggle = document.getElementById('themeToggle');

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ¨
    let books = [];
    let editIndex = null; // null => Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø±Ù‚Ù… => ØªØ¹Ø¯ÙŠÙ„

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    const STORAGE_KEY = 'my_books_v1';

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨ Ù…Ù† localStorage Ø£Ùˆ Ø¹ÙŠÙ†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    function loadBooks(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw){
        try { books = JSON.parse(raw) } catch(e){ books = [] }
      } else {
        // Ø¹ÙŠÙ†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø´ÙƒÙ„
        books = [
          {id:Date.now()+1, title:'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø£ÙˆÙ„', author:'Ù…Ø¤Ù„Ù 1', category:'Ø±ÙˆØ§ÙŠØ©', description:'Ù†Ø¨Ø°Ø© Ù‚ØµÙŠØ±Ø© Ø¹Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø£ÙˆÙ„.', cover:'https://via.placeholder.com/400x250?text=Cover+1'},
          {id:Date.now()+2, title:'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ', author:'Ù…Ø¤Ù„Ù 2', category:'Ù…Ù‚Ø§Ù„', description:'Ù†Ø¨Ø°Ø© Ù‚ØµÙŠØ±Ø© Ø¹Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ.', cover:'https://via.placeholder.com/400x250?text=Cover+2'}
        ];
        saveBooks();
      }
    }

    function saveBooks(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(books));
    }

    // Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ¨
    function renderBooks(filter=''){
      cardsContainer.innerHTML = '';
      const q = filter.trim().toLowerCase();
      const filtered = books.filter(b => {
        if(!q) return true;
        return (b.title||'').toLowerCase().includes(q) || (b.author||'').toLowerCase().includes(q) || (b.category||'').toLowerCase().includes(q);
      });

      countEl.textContent = filtered.length;

      if(filtered.length === 0){
        cardsContainer.innerHTML = '<p style="text-align:center;color:var(--muted);width:100%">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØªØ¨ Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>';
        return;
      }

      filtered.forEach((b, idx) => {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          ${b.category ? `<div class="badge">${escapeHtml(b.category)}</div>` : ''}
          <img src="${escapeHtml(b.cover || 'https://via.placeholder.com/400x250?text=No+Cover')}" alt="ØºÙ„Ø§Ù ${escapeHtml(b.title)}">
          <div class="body">
            <h3>${escapeHtml(b.title)}</h3>
            <p>${escapeHtml(b.author)}</p>
            <div class="actions">
              <button class="icon-btn" data-action="edit" data-id="${b.id}">ØªØ¹Ø¯ÙŠÙ„</button>
              <button class="icon-btn" data-action="delete" data-id="${b.id}">Ø­Ø°Ù</button>
            </div>
          </div>
        `;
        cardsContainer.appendChild(card);
      });
    }

    // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯
    function openModal(mode='add', book=null){
      modal.classList.add('open');
      if(mode === 'add'){
        document.getElementById('modalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯';
        editIndex = null;
        titleInput.value = '';
        authorInput.value = '';
        categoryInput.value = '';
        descriptionInput.value = '';
        coverUrl.value = '';
        coverPreview.src = 'https://via.placeholder.com/300x150?text=Cover';
        coverFile.value = '';
      } else if(mode === 'edit' && book){
        document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨';
        editIndex = books.findIndex(x => x.id === book.id);
        titleInput.value = book.title || '';
        authorInput.value = book.author || '';
        categoryInput.value = book.category || '';
        descriptionInput.value = book.description || '';
        coverUrl.value = book.cover && book.cover.startsWith('data:') ? '' : (book.cover || '');
        coverPreview.src = book.cover || 'https://via.placeholder.com/300x150?text=Cover';
        coverFile.value = '';
      }
      titleInput.focus();
    }

    function closeModal(){
      modal.classList.remove('open');
    }

    // Ø­ÙØ¸/ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØªØ§Ø¨
    async function handleSave(){
      const title = titleInput.value.trim();
      const author = authorInput.value.trim();
      const category = categoryInput.value.trim();
      const description = descriptionInput.value.trim();
      let cover = coverUrl.value.trim();

      if(!title || !author){
        alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø¤Ù„Ù');
        return;
      }

      // Ø¥Ø°Ø§ ØªÙ… Ø±ÙØ¹ Ù…Ù„Ù ØµÙˆØ±Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡
      if(coverFile.files && coverFile.files[0]){
        try {
          cover = await fileToDataUrl(coverFile.files[0]);
        } catch(e){
          console.error(e);
        }
      }

      if(editIndex === null){
        // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯
        const newBook = {
          id: Date.now(),
          title, author, category, description, cover
        };
        books.unshift(newBook);
      } else {
        // ØªØ¹Ø¯ÙŠÙ„
        books[editIndex] = {
          ...books[editIndex],
          title, author, category, description, cover: cover || books[editIndex].cover
        };
      }

      saveBooks();
      renderBooks(searchInput.value);
      closeModal();
    }

    // ØªØ­ÙˆÙŠÙ„ Ù…Ù„Ù Ø¥Ù„Ù‰ Data URL
    function fileToDataUrl(file){
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù
    cardsContainer.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if(!btn) return;
      const action = btn.getAttribute('data-action');
      const id = Number(btn.getAttribute('data-id'));
      if(action === 'edit'){
        const book = books.find(b => b.id === id);
        if(book) openModal('edit', book);
      } else if(action === 'delete'){
        if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒØªØ§Ø¨ØŸ')){
          books = books.filter(b => b.id !== id);
          saveBooks();
          renderBooks(searchInput.value);
        }
      }
    });

    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø±ÙØ¹ Ù…Ù„Ù
    coverUrl.addEventListener('input', () => {
      const v = coverUrl.value.trim();
      coverPreview.src = v || 'https://via.placeholder.com/300x150?text=Cover';
    });

    coverFile.addEventListener('change', async () => {
      if(coverFile.files && coverFile.files[0]){
        try {
          const data = await fileToDataUrl(coverFile.files[0]);
          coverPreview.src = data;
        } catch(e){
          console.error(e);
        }
      }
    });

    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    openAdd.addEventListener('click', () => openModal('add'));
    cancel.addEventListener('click', closeModal);
    saveBook.addEventListener('click', handleSave);

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    modal.addEventListener('click', (e) => {
      if(e.target === modal) closeModal();
    });

    // Ø¨Ø­Ø«
    searchInput.addEventListener('input', () => renderBooks(searchInput.value));
    clearSearch.addEventListener('click', () => { searchInput.value=''; renderBooks(''); });

    // Ø«ÙŠÙ… Ø¨Ø³ÙŠØ·
    function loadTheme(){
      const t = localStorage.getItem('theme');
      if(t === 'dark') document.body.setAttribute('data-theme','dark');
      updateThemeBtn();
    }
    function toggleTheme(){
      const isDark = document.body.getAttribute('data-theme') === 'dark';
      if(isDark){ document.body.removeAttribute('data-theme'); localStorage.setItem('theme','light'); }
      else { document.body.setAttribute('data-theme','dark'); localStorage.setItem('theme','dark'); }
      updateThemeBtn();
    }
    function updateThemeBtn(){ themeToggle.textContent = document.body.getAttribute('data-theme') === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'; }
    themeToggle.addEventListener('click', toggleTheme);

    // Ù…Ø³Ø§Ø¹Ø¯Ø©: Ø­Ù…Ø§ÙŠØ© Ù…Ù† XSS Ø¨Ø³ÙŠØ·Ø© Ø¹Ù†Ø¯ Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ
    function escapeHtml(str){
      if(!str) return '';
      return String(str).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }

    // ØªÙ‡ÙŠØ¦Ø©
    loadTheme();
    loadBooks();
    renderBooks();

  </script>
</body>
</html>
